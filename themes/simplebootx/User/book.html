<tc_include file="Public:head" />
<script>
    //全局变量
    var GV = {
        ROOT: "__ROOT__/",
        WEB_ROOT: "__WEB_ROOT__/",
        JS_ROOT: "public/js/",
        APP:'{$Think.MODULE_NAME}'/*当前应用名*/
    };
</script>
<link href="__PUBLIC__/js/artDialog/skins/default.css" rel="stylesheet" />
<link rel="stylesheet" href="__TMPL__Public/assets/css/base.css">
<link rel="stylesheet" href="__TMPL__Public/assets/css/iconfont/iconfont.css">
<link rel="stylesheet" href="__TMPL__Public/assets/css/subscribe.css">
<script type="text/html" id="photos-item-wrapper">
    <li id="savedimage{id}">
        <input id="photo-{id}" class="photos_url" type="hidden" name="photos_url[]" value="{filepath}">
        <input id="photo-{id}-name" class="photos_alt" type="text" name="photos_alt[]" value="{name}" style="width: 160px;height:36px" title="图片名称">
        <img id="photo-{id}-preview" src="{url}" style="height:36px;width: 36px;" onclick="parent.image_preview_dialog(this.src);">
        <a href="javascript:upload_one_image('图片上传','#photo-{id}');">替换</a>
        <a href="javascript:(function(){$('#savedimage{id}').remove();})();">移除</a>
    </li>
</script>
</head>
<body>
<tc_include file="Public:nav" />
<section class="container subs-container clearfix">
    <div class="subs-left float-left">
        <div class="person-img">
            <img src="{:sp_get_image_preview_url($smeta['thumb'])}" width="140" height="140" style="border-radius: 50%;"/>
        </div>
        <h2>{$teacher.name}</h2>
        <if condition="($teacher['status'] eq 1)">
            <span><i class="icon iconfont"></i>普通教员</span>
            <else />
            <span><i class="icon iconfont icon-star"></i>明星教员</span>
        </if>
        <ul class="left-tab">
            <li><a href="{:U("User/index/index")}" style="color:black">修改简历</a></li>
            <li class="active">订阅信息</a></li>
            <li><a href="{:U("User/index/parent")}" style="color:black">预约家长</li></a></li>
            <li><a href="{:U("User/index/pass_index")}" style="color:black">修改密码</a></li>
        </ul>
    </div>
    <div class="subs-right float-right" style="display:block">
        <div class="right-container subs-info-box" style="display:block">
            <ul class="tab">
                <li class="active">订阅中心</li>
                <li>我的订阅</li>

            </ul>
            <!--订阅标签-->
            <div class="subs-info my-subs">
                <foreach name="tag" key="k" item="tag_one">
                    <div class="subs-item clearfix">
                        <p class="float-left">{$tag_one}</p>
                        <div class="float-right no-subsed">
                            <if condition="in_array($k, $tag_in)">
                                <span>已订阅</span>
                                <span data="{$k}" class="un_s">取消</span>
                                <else />
                                <span data='{$k}' style="border:none" class="on_s">订阅</span>
                            </if>

                        </div>
                    </div>
                </foreach>
            </div>
            <!--订阅标签end-->
            <!--我的订阅-->
            <div class="subs-info subs-center">
                <if condition="tag_in">
                    <foreach name="tag_in" item="tag_in_one">
                        <div class="subs-item clearfix">
                            <p class="float-left">{$tag[$tag_in_one]}</p>
                            <div class="float-right subsed un_s" style="cursor: pointer;" data="{$tag_in_one}">取消订阅</div>
                        </div>
                    </foreach>
                    <else />
                    <div class="none-subs">
                        暂无订阅信息。
                    </div>
                </if>
            </div>
            <!--我的订阅end-->


        </div>
    </div>
</section>
<tc_include file="Public:footer"/>
<tc_include file="Public:scripts"/>
<script src="__PUBLIC__/js/wind.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
<script src="__TMPL__Public/assets/js/jquery.validate-1.13.1.js"></script>
<script>
    $(function(){
        //左右两侧的tab切换
        //Tab('.left-tab li','.right-container');
//        $('.left-tab li').on('click', function(){
//            $(this).addClass('active').siblings().removeClass('active');
//            $('.right-container').hide();
//            $('.right-container'+':nth-child('+($(this).index()+1)+')').show();
//        });

        //修改简历
        $('.change-resume-box .resume-tab li').on('click', function(){
            $(this).addClass('active').siblings().removeClass('active');
            $('.my-resume-content').hide();
            if($(this).index() == 0){
                $('.person-info').show();
            }else{
                $('.change-photo').show();
            }
        });
        //订阅信息
        $('.subs-info-box .tab li').on('click', function(){
            $(this).addClass('active').siblings().removeClass('active');
            $('.subs-info').hide();
            if($(this).index() == 0){
                $('.my-subs').show();
            }else{
                $('.subs-center').show();
            }
        });

        // 取消订阅
        $('.un_s').on('click', function(){
            var tag_id  =   $(this).attr('data');
            $.ajax({
                url: '{:U("User/index/edit_subscription")}',
                dataType: "json",
                type: "post",
                data:{'tag_id':tag_id,'action':'un'},
                success: function(data) {
                    if (data.status == 0) {

                        alert(data.info);
                    } else if(data.status == 1) {
                        window.location.reload();
                    }
                }
            });
        })

        // 订阅
        $('.on_s').on('click', function(){
            var tag_id  =   $(this).attr('data');
            $.ajax({
                url: '{:U("User/index/edit_subscription")}',
                dataType: "json",
                type: "post",
                data:{'tag_id':tag_id,'action':'on'},
                success: function(data) {
                    if (data.status == 0) {

                        alert(data.info);
                    } else if(data.status == 1) {
                        window.location.reload();
                    }
                }
            });
        })
    });


    $.validator.setDefaults({
        debug: true
    });
    $('.teacher-validate').validate({
        rules: {
            username: {
                required: true
            },
            identity: {
                required: true
            },
            "counseling_id": {
                required: true
            },
            myself: {
                required: true
            },
            teaching: {
                required: true
            },
            phone: {
                required: true
            },
        },
        messages: {
            username: {
                required: "请输入您的真实姓名"
            },
            identity: {
                required: "请选择一个身份"
            },
            school: {
                required: "请输入所在院校"
            },
            specialty: {
                required: "请输入所学专业"
            },
            company: {
                required: "请输入您的在职院校"
            },
            "counseling_id": {
                required: "请选择一个辅导科目"
            },
            myself: {
                required: "请填写自我介绍"
            },
            teaching: {
                required: "请填写教学经历"
            },
            phone: {
                required: "请填写手机号"
            },
        },
        submitHandler: function(form){
            console.log($(form).serialize());
        }
    });
    $.validator.setDefaults({
        debug: true
    });
    $('#pas').validate({
        rules: {
            old: {
                required: true
            },
            password: {
                required: true
            },
            repassword: {
                required: true
            },
        },
        messages: {
            old: {
                required: "请填写旧密码"
            },
            password: {
                required: "请填写新密码"
            },
            repassword: {
                required: "请填写重复密码"
            },
        },
        submitHandler: function(form){
            console.log($(form).serialize());
        }
    });
    //提交
    $('.pas_btn').on('click', function(){

        var formData = {
            "old": $('.old').val(),//教学经历
            "password": $('.password').val(),
            "repassword": $('.repassword').val(),
        }

//        console.log(formData);return false;

        if($('#pas').valid()){
            //调用AJAX提交表单
            $.ajax({
                url: '{:U("User/index/repass")}',
                dataType: "json",
                type: "post",
                data:formData,
                success: function(data) {
                    if (data.status == 0) {
                        alert(data.info);
                    } else if(data.status == 1) {
                        window.location.reload();
                    }
                }
            });
        }
    });


    //提交
    $('.btn_teacher').on('click', function(){
        var counseling = [];
        $('.counseling_id').each(function(){
            if ($(this).val()) {
                counseling.push($(this).val());
            }
        });

        var photos_alt  =   [];
        $('.photos_alt').each(function(){
            if ($(this).val()) {
                photos_alt.push($(this).val());
            }
        });


        var photos_url  =   [];
        $('.photos_url').each(function(){
            if ($(this).val()) {
                photos_url.push($(this).val());
            }
        });

        var formData = {
            "name": $('.username').val(),//名称
            "sex": $('.icon-choose').parents('.my-radio').attr('oid'),//性别
            "identity": $('.identity').val(),//身份
            "grade": $('.grade').val(),//所在年级
            "thumb": $('#thumb').val(),//照片
            "counseling_id": counseling,//科目1
            "counseling_other": $('.subject-four').val(),//4
            "stage": $('.stage').val(),//*教学阶段
            "introduction": $('.myself').val(),//自我介绍
            "teaching_experience": $('.teaching').val(),//教学经历
            "photos_alt": photos_alt,
            "photos_url": photos_url,
        }

//        console.log(formData);return false;

        if($('.teacher-validate').valid()){
            //调用AJAX提交表单
            $.ajax({
                url: '{:U("User/index/edit_post")}',
                dataType: "json",
                type: "post",
                data:formData,
                success: function(data) {
                    if (data.status == 0) {
                        alert(data.info);
                    } else if(data.status == 1) {
                        window.location.reload();
                    }
                }
            });
        }
    });
</script>
{:hook('footer_end')}
</body>
</html>