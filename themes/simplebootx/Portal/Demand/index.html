<tc_include file="Public:head" />

<link rel="stylesheet" href="__TMPL__Public/assets/css/base.css">
<link rel="stylesheet" href="__TMPL__Public/assets/css/iconfont/iconfont.css">
<link rel="stylesheet" href="__TMPL__Public/assets/css/tutor.css">
<style>
    .mask .input{width:50%}
</style>
</head>
<body>
<tc_include file="Public:nav" />
<section class="demand-container">
    <div class="container demand-info-box">
        <h1>家长（学员）<span class="s-color">在线提交</span>完整需求</h1>
        <h2>注册太麻烦？试试<span class="s-color s-btn" style="cursor: pointer;">快速提交入口</span></h2>

        <form id="tutor-form">
            <div class="base-info">
                <div class="title-box clearfix">
                    <p class="title"><span class="vertical"></span>基本情况</p>
                </div>
                <div class="base-info-box">
                    <div class="form-control clearfix">
                        <label><span>*</span>您的称呼</label>
                        <select name="sex" class="small-sel small-sel-two sex-sel">
                            <option value="1">女士</option>
                            <option value="2">男士</option>
                        </select>
                        <input type="text" class="middel-input username" name="name">
                    </div>
                    <div class="form-control clearfix">
                        <label><span>*</span>学员年级</label>
                        <php>
                            $grade = sp_get_grade_name();
                        </php>
                        <select id="" class="large-sel grade" name="grade_id">
                            <option value="">--请选择年级--</option>
                            <foreach name="grade" key="k" item="vo">
                                <option value="{$k}">{$vo}</option>
                            </foreach>
                        </select>
                    </div>
                    <php>
                        $counseling = sp_get_counseling();
                    </php>
                    <div class="form-control clearfix">
                        <label><span>*</span>辅导科目</label>
                        <select class="large-sel subjects-one counseling_id" name="counseling_id[]">
                            <option value="">--请选择辅导课程--</option>
                            <foreach name="counseling" key="k" item="vo">
                                <option value="{$k}">{$vo}</option>
                            </foreach>
                        </select>
                    </div>
                    <div class="form-control clearfix">
                        <label></label>
                        <select class="large-sel subjects-two counseling_id" name="counseling_id[]">
                            <option value="">--请选择辅导课程--</option>
                            <foreach name="counseling" key="k" item="vo">
                                <option value="{$k}">{$vo}</option>
                            </foreach>
                        </select>
                    </div>
                    <div class="form-control clearfix">
                        <label></label>
                        <select class="large-sel subjects-three counseling_id" name="counseling_id[]">
                            <option value="">--请选择辅导课程--</option>
                            <foreach name="counseling" key="k" item="vo">
                                <option value="{$k}">{$vo}</option>
                            </foreach>
                        </select>
                    </div>
                    <div class="form-control clearfix">
                        <label></label>
                        <input type="text" name='counseling_other' class="subjects-four" placeholder="输入您需要辅导的其它科目">
                    </div>
                </div>
            </div>
            <div class="situation">
                <div class="title-box clearfix">
                    <p class="title"><span class="vertical"></span>情况与要求</p>
                </div>
                <div class="situation-box">
                    <!--<div class="form-control clearfix">-->
                        <!--<label for="">学员性别</label>-->
                        <!--<span class="my-radio" oid="0" style="line-height: 40px;"><i class="icon iconfont  icon-choose"></i>男</span>-->
                        <!--<span class="my-radio" oid="1" style="margin-left:20px;line-height: 40px;"><i class="icon iconfont icon-ring"></i>女</span>-->
                    <!--</div>-->
                    <div class="form-control clearfix">
                        <label for="">拟付薪酬</label>
                        <input name="prepayments" type="text" class="money">
                        <span style="color:#aaa;line-height: 40px;margin-left: 4px;">单位：元/小时</span>
                    </div>
                    <div class="form-control clearfix">
                        <label class="float-left" for="">家教时间</label>
                        <div class="float-left table">
                            <div class="header">
                                <div class="col"></div>
                                <div class="col">周一</div>
                                <div class="col">周二</div>
                                <div class="col">周三</div>
                                <div class="col">周四</div>
                                <div class="col">周五</div>
                                <div class="col">周六</div>
                                <div class="col">周日</div>
                                <div class="col">寒假</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="Z-1"></i></div>
                            </div>
                            <div class="row">
                                <div class="col">上午</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-check-squre" oid="S-1"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="S-2"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="S-3"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="S-4"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="S-5"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="S-6"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="S-6"></i></div>
                                <div class="col">暑假</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="Z-2"></i></div>
                            </div>
                            <div class="row">
                                <div class="col">下午</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-1"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-2"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-3"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-4"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-5"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-6"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="X-7"></i></div>
                                <div class="col">长期</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="Z-3"></i></div>
                            </div>
                            <div class="row">
                                <div class="col">晚上</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-1"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-2"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-3"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-4"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-5"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-6"></i></div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="W-7"></i></div>
                                <div class="col">面议</div>
                                <div class="my-checkbox col"><i class="icon iconfont icon-squre" oid="Z-4"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-control clearfix">
                        <label for="">老师要求</label>
                        <select name="teacher_sex" class="small-sel small-sel-two teacher-sex">
                            <option value="1">女性</option>
                            <option value="2">男性</option>
                        </select>
                        <select name="identity" class="middel-input identity">
                            <option value="">--请选择老师身份--</option>
                            <option value="1">大学生</option>
                            <option value="2">研究生</option>
                            <option value="3">在职老师</option>
                            <option value="4">专职老师</option>
                        </select>
                    </div>
                    <div class="form-control clearfix">
                        <label class="float-left">其它要求</label>
                        <div class="float-left">
                            <textarea name="remarks" class="others"></textarea>
                        </div>
                        <div class="float-left tags">
                            <span class="tag">有家教经验</span>
                            <span class="tag">教学有方法</span>
                            <span class="tag">时间观念强</span>
                            <span class="tag">责任心强</span>
                            <span class="tag">普通话标准</span>
                            <span class="tag">认真且有教案</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="contact">
                <div class="title-box clearfix">
                    <p class="title"><span class="vertical"></span>基本情况</p>
                </div>
                <div class="form-control clearfix">
                    <label><span>*</span>手机号码</label>
                    <input type="text" class="phone" name="phone">
                </div>
                <php>
                    $area = sp_get_area();
                </php>
                <div class="form-control clearfix">
                    <label><span>*</span>家庭住址</label>
                    <select name="area_id" class="area_id small-sel small-sel-two">
                        <option value="">请选择地区</option>
                        <foreach name="area" key="k" item="area_one">
                            <option value="{$k}">{$area_one}</option>
                        </foreach>
                    </select>
                    <input type="text" class="middel-input address" placeholder="请输入家庭住址" name="address">
                </div>
                <?php
                    if ($is_code == 1) {
                ?>
                    <div class="form-control clearfix">
                        <label><span>*</span>验证码</label>
                        <input type="text" class="middel-input img-code" name="verify">
                        <span class="span-code">
                            <!--<img src="/index.php?g=api&m=checkcode&a=index&length=4&font_size=20&width=109&height=40&use_noise=1&use_curve=0" onclick="this.src='/index.php?g=api&m=checkcode&a=index&length=3&font_size=18&width=109&height=40&use_noise=1&use_curve=0&time='+Math.random();" />-->
                            {:sp_verifycode_img('length=3&font_size=20&width=109&height=40&use_noise=1&use_curve=0','style="cursor: pointer;" title="点击获取"')}
                        </span>
                    </div>
                <?php
                    } else if($is_code == 2) {
                ?>
                    <div class="form-control clearfix">
                        <label><span>*</span>短信验证码</label>
                        <input type="text" class="middel-input messge-code" name="sms">
                        <span class="span-code span-btn sms">接收短信验证码</span>
                    </div>
                <?php
                    }
                ?>


            </div>
            <input type="button" class="btn" value="提交"/>
        </form>
    </div>
</section>

<section class="login-container">
    <div class="mask">
        <div class="login-box">
            <div class="title">
                家长（学员）快速注册
                <span class="close">X</span>
            </div>
            <div class="container-content">
                <form id="ksfrom">
                    <div class="form-control clearfix" style="margin-top: 65px;">
                        <label><span>*</span>姓名</label>
                        <input type="text" class="ksname" style='width:50%' name="name">
                    </div>
                    <div class="form-control clearfix">
                        <label><span>*</span>手机号</label>
                        <input type="text"  style='width:50%' id="phone" name="phone">
                    </div>
                    <php>
                        $counseling = sp_get_counseling();
                    </php>
                    <div class="form-control clearfix">
                        <label><span>*</span>辅导科目</label>
                        <select class="kscounseling_id" name="counseling_id[]" style='width:50%'>
                            <option value="">--请选择辅导课程--</option>
                            <foreach name="counseling" key="k" item="vo">
                                <option value="{$k}">{$vo}</option>
                            </foreach>
                        </select>
                    </div>
                    <div class="form-control clearfix">
                        <label for=""></label>
                        <input name="counseling_other" class="kscounseling_other" style='width:50%' type="text" placeholder="请输入您要辅导的其它科目">
                    </div>
                    <div class="form-control clearfix">
                        <label for=""><span>*</span>家庭住址</label>
                        <select name="area_id" class="ksarea_id" style="width:50%">
                            <option value="">请选择地区</option>
                            <foreach name="area" key="k" item="area_one">
                                <option value="{$k}">{$area_one}</option>
                            </foreach>
                        </select>
                    </div>
                    <div class="form-control clearfix">
                        <label for=""><span></span></label>
                        <input class="ksaddress" name="address" style='width:50%' type="text" placeholder="请输入您的家庭住址">
                    </div>
                    <?php
                        if ($is_code == 1) {
                    ?>
                    <div class="form-control clearfix">
                        <label><span>*</span>验证码</label>
                        <input type="text" class="ksverify" style='width:50%' style="width: 51%;" name="verify">
                        <span class="span-code">{:sp_verifycode_img('length=3&font_size=20&width=109&height=40&use_noise=1&use_curve=0','style="cursor: pointer;" title="点击获取"')}</span>
                    </div>
                    <?php
                        } else {
                    ?>
                    <div class="form-control clearfix">
                        <label><span>*</span>短信验证码</label>
                        <input type="text" class="kssms" style='width:50%' style="width: 51%;" name="sms">
                        <span class="span-code span-btn kssms_1">接收短信验证码</span>
                    </div>
                    <?php
                        }
                    ?>
                    <input type="submit" id="ksbut" style="width: 20%;" vlaue="提交" class="login-btn">
                </form>
            </div>
        </div>
    </div>
</section>

<tc_include file="Public:footer"/>

<tc_include file="Public:scripts"/>

<div class="alert-mask">
    <div class="alert-box">
        <div class="alert-title">
            提示
            <span class="close">X</span>
        </div>
        <div class="alert-content">
             提交成功！
        </div>
    </div>
</div>
<script src="__TMPL__Public/assets/js/jquery.validate-1.13.1.js"></script>
<script>
    $(document).ready(function(){
        $('.sms').click(function(){
            var phone = $('.phone').val();
            if (!isPhoneNo(phone)) {
                alert('请输入正确的手机号');
            } else {
                $.ajax({
                    url: '{:U("Demand/get_sms")}',
                    dataType: "json",
                    type: "post",
                    data:{phone:phone},
                    success: function(msg) {
                        if (msg.code == 1) {
                            $('.sms').html('发送成功');
                        } else {
                            alert(msg.info);
                        }
                    }
                });
            }
        })

        $('.kssms_1').click(function(){
            var ksphone = $('#phone').val();
            if (!isPhoneNo(ksphone)) {
                alert('请输入正确的手机号');
            } else {
                $.ajax({
                    url: '{:U("Demand/get_sms")}',
                    dataType: "json",
                    type: "post",
                    data:{phone:ksphone},
                    success: function(msg) {
                        if (msg.code == 1) {
                            $('.kssms_1').html('发送成功');
                        } else {
                            alert(msg.info);
                        }
                    }
                });
            }
        })


        // 验证手机号
        function isPhoneNo(phone) {
            var pattern = /^1[34578]\d{9}$/;
            return pattern.test(phone);
        }

        //表单验证
        $.validator.setDefaults({
            debug: true
        });

        $('#ksfrom').validate({
            rules: {
                name: {
                    required: true
                },
                'phone': {
                    required: true
                },
                'counseling_id[]': {
                    required: true
                },
                area_id: {
                    required: true
                },
                address: {
                    required: true
                },
            },
            messages: {
                name: {
                    required: '请输入您的真实姓名'
                },
                'phone': {
                    required: '请选择手机号'
                },
                'counseling_id[]': {
                    required: "请至少选择一个科目"
                },
                area_id: {
                    required: "请选择一个地区"
                },
                address: {
                    required: "请选择一个地址"
                },

            },
            submitHandler: function(form){
                console.log($(form).serialize());
            }
        });

        $('#ksbut').on('click', function(){
            var counseling = [];
            counseling.push($('.kscounseling_id').val());

            var formData = {
                "name": $('.ksname').val(),//名称
                "phone": $('#phone').val(),//手机号
                "counseling_id": counseling,//科目1
                "counseling_other": $('.kscounseling_other').val(),//4
                'area_id': $('.ksarea_id').val(),
                "address": $('.ksaddress').val(),//住址
            <?php
            if ($is_code == 1) {
                ?>
                "verify": $('.ksverify').val(),//验证码－图文
                <?php
            } else if($is_code == 2) {
                ?>
                "sms": $('.kssms').val()//验证码－短信
                <?php
            }
            ?>

            }

            if($('#ksfrom').valid()){
                //调用AJAX提交表单
                $.ajax({
                    url: '{:U("Demand/add_kspost")}',
                    dataType: "json",
                    type: "post",
                    data:formData,
                    success: function(data) {
                        if (data.status == 0) {
                            alert(data.info);
                        } else if(data.status == 1) {
                            alert(data.info);
                            location.reload();
                        }
                    }
                });
            }
        })

        $('#tutor-form').validate({
            rules: {
                name: {
                    required: true
                },
                'grade_id': {
                    required: true
                },
                identity: {
                    required: true
                },
                'counseling_id[]': {
                    required: true
                },
                subjects: {
                    required: true
                },
                phone: {
                    required: true
                },
                address: {
                    required: true
                },
                area_id: {
                    required: true
                }
            },
            messages: {
                name: {
                    required: "请输入您的真实姓名"
                },
                'grade_id':{
                    required: '请选择年级'
                },
                identity: {
                    required: "请选择一个老师身份"
                },
                'counseling_id[]': {
                    required: "请至少选择一个科目"
                },
                phone: {
                    required: "请输入正确的手机号"
                },
                address: {
                    required: "请输入地址"
                },
                area_id: {
                    required: "请选择地区"
                }
            },
            submitHandler: function(form){
                console.log($(form).serialize());
            }
        });
        //提交
        $('.btn').on('click', function(){
            var times = [];
            $('.icon-check-squre').each(function(){
                times.push($(this).attr('oid'));
            });
            var counseling = [];
            $('.counseling_id').each(function(){
                if ($(this).val()) {
                    counseling.push($(this).val());
                }
            });
            var formData = {
                "sex": $('.sex-sel').val(),//性别
                "name": $('.username').val(),//名称
                "grade_id": $('.grade').val(),//年级
                "identity": $('.identity').val(),//身份
                "counseling_id": counseling,//科目1
                "counseling_other": $('.subjects-four').val(),//4
                "prepayments": $('.money').val(),//拟付薪酬
                "time": times,
                "teacher_sex": $('.teacher-sex').val(),//老师性别
                "remarks": $('.others').val(),//其它要求
                "phone": $('.phone').val(),//手机号
                "address": $('.address').val(),//住址
                'area_id': $('.area_id').val(),
                <?php
                    if ($is_code == 1) {
                ?>
                "verify": $('.img-code').val(),//验证码－图文
                <?php
                    } else if($is_code == 2) {
                ?>
                "sms": $('.messge-code').val()//验证码－短信
                <?php
                    }
                ?>

            }
            if($('#tutor-form').valid()){
                //调用AJAX提交表单
                $.ajax({
                    url: '{:U("Demand/add_post")}',
                    dataType: "json",
                    type: "post",
                    data:formData,
                    success: function(data) {
                        $('.alert-content').html(data.info);
                        $('.alert-mask').show();
                        if (data.status == 1) {
                            setTimeout("location.reload()",1000);
                        }
                    }
                });
            }
        });
    })
    //提示框关闭
    $('.alert-title .close').on('click', function(){
        $('.alert-mask').hide();
//        location.reload()
    });

    $('.s-btn').on('click', function(){
        $('.login-container').show();
    })
    //关闭
    $('.close').on('click', function(){
        $('.login-container').hide();
    });

</script>
{:hook('footer_end')}
</body>
</html>
